single sign on SSO 单点登陆（企业业务整合方案）
[https://www.cnblogs.com/ywlaker/p/6113927.html]
在具有多个应用的系统中，用户只需要登陆一次就可以访问所有互相信任的应用系统
```angular2
  OAuth2 
 在客户端和服务提供商之前设置于一个授权层，
 客户端只能登陆授权层，在此将用户与客户端分开
 用户在登录时指定授权层令牌的权限和有效期
 客户端用过授权层的令牌来访问服务提供商的资源
 
 客户端的授权模式：
 授权码模式、简化模式、密码模式、客户端模式
 
 授权码模式：
 通过客户端的后台服务器与“服务提供商的认证服务器”进行互动
 1.用户访问客户端，后端将前端导向认证服务器
 2.用户选择是否给与客户端授权
 3.假如用户给予授权，认证服务器将用户导向客户端事先指定的“重定向URI”
 redirection URI,同时附上一个授权码
 4.客户端收到授权码，附上早先之前的“重定向URI”向认证服务器申请令牌。
 在客户端后台服务器完成，用户不可见
 5.认证服务器核对授权码和重定向uri，确认后，向客户端发送访问令牌
 access token和更新令牌refresh token
```
* 单系统的登陆状态可以通过客户端cookie和服务器端的session来维护
* 多系统由于cookie不能跨域  域名+端口+协议
    浏览器发送http请求的时候会带上与该域匹配的cookies，而不是所有的域
S1.早期通过把cookies设置到顶级域名下    
    所有系统需要统一到同一个域名下，所有系统开发语音需要统一
    cookie无法跨平台通用
    cookie本身是不安全的，可以被盗取
    
S2.单点登陆
    一个独立的统一认证中心,只有认证中心可以接收用户名和密码，系统不提供登陆入口，只接收认证中心的间接授权。
    间接授权通过令牌实现，sso认证中心确认用户名密码正确就颁发令牌，接下来的跳转中，令牌作为参数发送到系统中。
    子系统拿到令牌向认证中心确认，成功就可以借此创建局部会话，返回受保护的资源。
    
登陆：    
    1.用户访问系统1的受保护资源，系统1发现用户未登录，跳转至sso认证中心，并将自己的地址作为参数
    2.sso认证中心发现用户未登录，将用户引导至登录页面
    3.用户输入用户名密码提交登录申请
    4.sso认证中心校验用户信息，创建用户与sso认证中心之间的会话，称为全局会话，同时创建授权令牌
    5.sso认证中心带着令牌跳转会最初的请求地址（系统1）
    6.系统1拿到令牌，去sso认证中心校验令牌是否有效
    7.sso认证中心校验令牌，返回有效，注册系统1
    8.系统1使用该令牌创建与用户的会话，称为局部会话，返回受保护资源    
       
注销：
    认证中心会监听全局会话的状态，一旦全局会话销毁，监听器会通知所有子系统注销会话来实现注销。
    1.用户向系统1发起注销请求
    2.系统1根据用户和系统1建立的会话找到令牌，向认证中心发起注销请求
    3.认证中心校验令牌有效性，销毁全局会话，同时取出此令牌注册的系统地址
    4.认证中心向所有注册地址发起注销请求
    5.子系统执行注销，销毁局部会话
    6.认证中心引导用户到登陆中心
    
实现：
sso-client
    1.拦截子系统未登录用户请求，跳转sso登陆中心
    2.接收存储sso发送的令牌  
    3.与sso-server通信，校验令牌有效性
    4.建立局部会话
    5.拦截用户注销请求，向sso中心发起注销
    6.接收sso的注销请求，销毁局部会话
    
sso-server    
    1.验证用户登陆信息
    2.创建全局会话
    3.创建授权令牌
    4.给client通信发送令牌
    5.校验令牌的有效性
    6.系统注册
    7.接收client的注销请求，消除全局会话
    
    
    
    
    